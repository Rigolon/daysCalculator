var configHttp={emulateHTTP:!0,emulateJSON:!0};new Vue({el:"#app",data:{loadingFeedback:!1,menu:!1,message:"",calcLoading:!1,config:{chronoEraStep:88},form:{cicle:88,min:1,max:3333,etherium:null,timeMint:null,chronoPower:null,tokensDayZero:null,etheriumAddress:null},chronoEra:{},page:1,pagination:50,url:"https://etherchain.org/api/account/0xA723606e907bF84215d5785Ea7f6cD93A0Fbd121/tx/",transactions:[],transactionsAgrouped:{},startDate1:"2017-08-28T13:00:00.000Z",startDate2:"2017-08-28T19:00:00.000Z",amountStartDate:5},mounted:function(){var t=this,e={};for(i=1;i<=40;i++)e[i]={era:Math.ceil(i/4),initDay:t.config.chronoEraStep*i-t.config.chronoEraStep+1,lastDay:t.config.chronoEraStep*i,effective:1==i?1:e[i-1].effective/2};t.chronoEra=e,t.getPositionsTransaction()},methods:{send:function(){var t=this;if(t.message.trim()){var e={message:t.message.trim()};t.loadingFeedback=!0,t.$http.post("/contact.php",e,configHttp).then(function(e){e.body.status&&(swal(msgSuccess,msgSuccessText,"success").catch(swal.noop),t.message="",t.loadingFeedback=!1,t.menu=!1)},function(e){swal(Oops,msgErrorText,"error").catch(swal.noop),t.message="",t.loadingFeedback=!1,t.menu=!1})}},getAddress:function(){if(this.transactionsAgrouped[this.form.etheriumAddress]){var t=0,e=this.transactionsAgrouped[this.form.etheriumAddress];for(i=0;i<e.length;i++)t+=e[i].amountFormated;this.form.etherium=String(t);var o=Object.keys(this.transactionsAgrouped).indexOf(this.form.etheriumAddress)+1;o>1e3&&(o+=300),this.form.timeMint=o,this.formEtherium(this.form.etherium)}else this.form.etheriumAddress&&(swal("Oops..",msgAlert,"error").catch(swal.noop),this.form.etheriumAddress=null)},getTransactions:function(t){var e=this,o=e.url,r=e.pagination*t-e.pagination;this.$http.get(o+r).then(function(o){o.body.data.length?(e.transactions=e.transactions.concat(o.body.data),setTimeout(function(){e.getTransactions(t+1)},1e4)):console.log(e.transactions)},function(t){})},getPositionsTransaction:function(){for(var t=this,e=transactions,o={},r=0;r<e.length;r++){var i=!1,n=e[r];n.amountFormated=n.amount/1e18,moment(n.time).isSameOrAfter(t.startDate1)&&n.amountFormated>=5&&(i=!0),!i&&moment(n.time).isSameOrAfter(t.startDate2)&&n.amountFormated>=1?i=!0:void 0!==o[n.sender]&&(i=!0),i&&n.gasLimit==n.gasUsed&&(i=!1),i&&(void 0===o[n.sender]&&(o[n.sender]=Array()),o[n.sender].push(n))}o=_.fromPairs(_.sortBy(_.toPairs(o),function(t){return new Date(t.time)}).reverse()),t.transactionsAgrouped=o},formEtherium:function(t){var e=Number(String(t).replace(",","."));if(e)if(e<1)swal("Oops",msgAlert2,"error").catch(swal.noop),this.form.etherium=null,this.form.chronoPower=null,this.form.tokensDayZero=null;else{var o=24*e;this.form.tokensDayZero=o}else this.form.etherium=null,this.form.chronoPower=null,this.form.tokensDayZero=null}},watch:{"form.timeMint":function(t){var e=this;if(Number(t)<this.form.min)e.$nextTick(function(){this.form.timeMint=this.form.min});else if(Number(t)>this.form.max)e.$nextTick(function(){this.form.timeMint=this.form.max});else{var o=Number(t);if(o){var r=.01-.005*(o-1)/3332;this.form.chronoPower=String(100*r)}}}},computed:{simulations:function(){var t=[],e=this;if(e.form.timeMint&&e.form.chronoPower){e.calcLoading=!0;var o=e.form.tokensDayZero;for(item in e.chronoEra){var r=e.chronoEra[item],i=o;item>1&&(void 0!==r[item-2]&&(o+=r[item-2].diff),i=t[item-2].last);var n=r.effective*this.form.chronoPower,a=i*Math.pow(1+n/100,e.config.chronoEraStep);t.push({chronoPower:n,period:item,start:Number(i),last:a,diff:a-i})}}return e.calcLoading=!1,t}}});